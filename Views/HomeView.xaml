<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Weak.ViewModels"
             xmlns:models="clr-namespace:Weak.Models"
             x:Class="Weak.Views.HomeView"
             Title="Workload">

    <ScrollView BackgroundColor="{StaticResource BackgroundLight}">
        <VerticalStackLayout Padding="24,16,24,96" Spacing="24">
            
            <!-- Top App Bar -->
            <Grid ColumnDefinitions="*, Auto" Margin="0,0,0,8">
                <Label Text="Workload" 
                       FontAttributes="Bold" 
                       FontSize="24" 
                       TextColor="{StaticResource TextPrimaryLight}"
                       VerticalOptions="Center"/>
                
                <Frame Grid.Column="1" 
                       HeightRequest="40" 
                       WidthRequest="40" 
                       CornerRadius="20" 
                       Padding="0" 
                       HasShadow="False"
                       BorderColor="{StaticResource Gray200}"
                       BackgroundColor="White">
                    <Image Source="user_user.png" 
                           Aspect="AspectFill"
                           Margin="8"/>
                     <!-- Note: Using placeholder image or just icon -->
                </Frame>
            </Grid>

            <!-- Intro Text -->
            <VerticalStackLayout Spacing="4">
                <Label Text="OVERVIEW" 
                       FontSize="12" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextSecondaryLight}" 
                       CharacterSpacing="1"/>
                <Label Text="{Binding OverviewText}" 
                       FontSize="18" 
                       TextColor="{StaticResource TextPrimaryLight}"
                       LineHeight="1.2"/>
            </VerticalStackLayout>

            <!-- Week Cards -->
            <StackLayout BindableLayout.ItemsSource="{Binding WeekCards}" Spacing="20">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="vm:WeekCard">
                        <Border StrokeShape="RoundRectangle 16"
                                Stroke="{StaticResource Gray100}"
                                StrokeThickness="1"
                                BackgroundColor="White"
                                Padding="24">
                            <Border.Shadow>
                                <Shadow Brush="Black"
                                        Offset="0,2"
                                        Radius="4"
                                        Opacity="0.05"/>
                            </Border.Shadow>
                            
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HomeViewModel}}, Path=ToggleExpandCommand}"
                                                      CommandParameter="{Binding .}"/>
                            </Border.GestureRecognizers>

                            <VerticalStackLayout Spacing="20">
                                <!-- Card Header -->
                                <Grid ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout Spacing="4">
                                        <HorizontalStackLayout Spacing="8">
                                            <BoxView Color="{StaticResource Primary}" 
                                                     HeightRequest="8" 
                                                     WidthRequest="8" 
                                                     CornerRadius="4"
                                                     VerticalOptions="Center"/>
                                            <Label Text="{Binding Title}" 
                                                   FontAttributes="Bold" 
                                                   FontSize="18"
                                                   TextColor="{StaticResource TextPrimaryLight}"/>
                                        </HorizontalStackLayout>
                                        <Label Text="{Binding DateRange}" 
                                               FontSize="14" 
                                               TextColor="{StaticResource TextSecondaryLight}"
                                               FontAttributes="Bold"/>
                                    </VerticalStackLayout>
                                    
                                    <HorizontalStackLayout Grid.Column="1" VerticalOptions="Start" Spacing="2">
                                        <Label Text="{Binding Score}" 
                                               FontSize="30" 
                                               FontAttributes="Bold" 
                                               TextColor="{StaticResource TextPrimaryLight}"/>
                                        <Label Text="/10" 
                                               FontSize="14" 
                                               FontAttributes="Bold" 
                                               TextColor="{StaticResource TextSecondaryLight}"
                                               VerticalOptions="End"
                                               Margin="0,0,0,6"/>
                                    </HorizontalStackLayout>
                                </Grid>

                                <!-- Progress Bar Section -->
                                <VerticalStackLayout Spacing="8">
                                    <Grid HeightRequest="16">
                                        <!-- Track -->
                                        <BoxView Color="{StaticResource BackgroundLight}" 
                                                 CornerRadius="8"
                                                 VerticalOptions="Fill" 
                                                 HorizontalOptions="Fill"/>
                                        
                                        <!-- Tick Marks -->
                                        <BoxView Color="White" Opacity="0.5" WidthRequest="1" HorizontalOptions="Start" Margin="{OnPlatform Android='80,0,0,0', Default='25%,0,0,0'}"/> <!-- Approximation -->
                                        
                                        <!-- Progress Indicator -->
                                        <!-- Since we can't easily bind WidthRequest to Percentage without converter, using ScaleX or Grid workaround. 
                                             Simpler: Use ProgressBar? No, need custom style. 
                                             Workaround: Grid with ColumnDefinitions. -->
                                         <!-- Using a simple BoxView with WidthRequest bound to a calculated property in VM would be best, 
                                              but here we have 'Progress' (0-1). We can use a custom Grid layout or AbsoluteLayout.
                                              AbsoluteLayout is good here. -->
                                         
                                        <AbsoluteLayout>
                                            <BoxView Color="{StaticResource Primary}" 
                                                     CornerRadius="8"
                                                     AbsoluteLayout.LayoutBounds="{Binding Progress, StringFormat='0,0,{0},1'}"
                                                     AbsoluteLayout.LayoutFlags="All"/>
                                        </AbsoluteLayout>
                                    </Grid>

                                    <Grid ColumnDefinitions="*, Auto">
                                        <Label Text="Intensity" 
                                               FontSize="12" 
                                               TextColor="{StaticResource TextSecondaryLight}"
                                               FontAttributes="Bold"/>
                                        
                                        <Border StrokeShape="RoundRectangle 4"
                                                BackgroundColor="{StaticResource BackgroundLight}"
                                                StrokeThickness="0"
                                                Padding="8,2">
                                            <Label Text="{Binding Intensity}" 
                                                   FontSize="12" 
                                                   FontAttributes="Bold" 
                                                   TextColor="{StaticResource Primary}"/>
                                        </Border>
                                    </Grid>
                                </VerticalStackLayout>
                                
                                <!-- Expanded Content (Stubbed) -->
                                <VerticalStackLayout IsVisible="{Binding IsExpanded}" Spacing="8">
                                    <BoxView HeightRequest="1" Color="{StaticResource Gray100}" Margin="0,8"/>
                                    <Label Text="Subject Breakdown" FontAttributes="Bold" FontSize="14"/>
                                    <Label Text="• Mathematics: 4.0" FontSize="13" TextColor="{StaticResource TextSecondaryLight}"/>
                                    <Label Text="• Physics: 3.2" FontSize="13" TextColor="{StaticResource TextSecondaryLight}"/>
                                    <Label Text="• History: 1.0" FontSize="13" TextColor="{StaticResource TextSecondaryLight}"/>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </StackLayout>
            
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
