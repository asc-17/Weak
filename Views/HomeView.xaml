<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Weak.ViewModels"
             xmlns:models="clr-namespace:Weak.Models"
             x:Class="Weak.Views.HomeView"
             Title="Workload"
             BackgroundColor="{StaticResource BackgroundLight}">


    <ScrollView>
        <VerticalStackLayout Padding="24,16,24,96" Spacing="24">
            
            <!-- Top App Bar -->
            <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                <Label Text="Workload" 
                       FontFamily="InterBold"
                       FontSize="28" 
                       TextColor="{StaticResource TextPrimaryLight}"
                       VerticalOptions="Center"/>
                
                <!-- Profile Button -->
                <Border Grid.Column="1" 
                        StrokeShape="Ellipse" 
                        HeightRequest="40" 
                        WidthRequest="40" 
                        Stroke="{StaticResource Gray200}"
                        StrokeThickness="1"
                        BackgroundColor="White"
                        VerticalOptions="Center"
                        HorizontalOptions="End">
                    <Image Source="omega.png" 
                           HeightRequest="40"
                           WidthRequest="40"
                           Aspect="AspectFill"
                           HorizontalOptions="Center" 
                           VerticalOptions="Center"/>
                </Border>
            </Grid>

            <!-- Intro/Overview Section -->
            <VerticalStackLayout Spacing="4">
                <Label Text="OVERVIEW" 
                       FontFamily="InterMedium"
                       FontSize="11" 
                       TextColor="{StaticResource TextSecondaryLight}"/>
                <Label Text="{Binding OverviewText}" 
                       FontFamily="InterRegular"
                       FontSize="17" 
                       LineHeight="1.3"
                       TextColor="{StaticResource TextPrimaryLight}"/>
            </VerticalStackLayout>

            <!-- Week Cards Collection -->
            <StackLayout BindableLayout.ItemsSource="{Binding WeekCards}" Spacing="24">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="models:WeekCard">
                        <Border StrokeShape="RoundRectangle 16" 
                                BackgroundColor="White"
                                Stroke="{StaticResource Gray100}"
                                StrokeThickness="1"
                                Padding="24"
                                Opacity="{Binding Opacity}">
                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="0,1" Radius="3" Opacity="0.05"/>
                            </Border.Shadow>
                            
                            <VerticalStackLayout Spacing="20">
                                <!-- Header Row -->
                                <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="8">
                                    <!-- Static Blue Dot Indicator for Current Week -->
                                    <Border Grid.Column="0"
                                            HeightRequest="8" 
                                            WidthRequest="8"
                                            StrokeShape="Ellipse"
                                            BackgroundColor="{StaticResource Primary}"
                                            StrokeThickness="0"
                                            VerticalOptions="Center"
                                            IsVisible="{Binding IsCurrentWeek}"/>

                                    <!-- Title and Date Range -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="2">
                                        <Label Text="{Binding Title}" 
                                               FontFamily="InterBold"
                                               FontSize="18" 
                                               TextColor="{StaticResource TextPrimaryLight}"/>
                                        <Label Text="{Binding DateRange}" 
                                               FontFamily="InterMedium"
                                               FontSize="13" 
                                               TextColor="{StaticResource TextSecondaryLight}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Score Display -->
                                    <HorizontalStackLayout Grid.Column="2" Spacing="2" VerticalOptions="Start">
                                        <Label FontFamily="InterBold"
                                               FontSize="32"
                                               TextColor="{StaticResource TextPrimaryLight}"
                                               VerticalOptions="Center">
                                            <Label.Text>
                                                <Binding Path="LoadScore" StringFormat="{}{0:F1}"/>
                                            </Label.Text>
                                        </Label>
                                        <Label Text="/10" 
                                               FontFamily="InterSemiBold"
                                               FontSize="13" 
                                               TextColor="{StaticResource Gray400}"
                                               VerticalOptions="End"
                                               Margin="0,0,0,4"/>
                                    </HorizontalStackLayout>
                                </Grid>

                                <!-- Progress Bar Section -->
                                <VerticalStackLayout Spacing="12">
                                    <!-- Progress Bar (Completion) -->
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="Progress" 
                                               FontFamily="InterMedium"
                                               FontSize="11" 
                                               TextColor="{StaticResource Gray400}"/>
                                        <Grid HeightRequest="12">
                                            <!-- Background Track -->
                                            <Border HeightRequest="12"
                                                    StrokeShape="RoundRectangle 6"
                                                    BackgroundColor="{StaticResource Gray100}"
                                                    StrokeThickness="0"/>
                                            
                                            <!-- Progress Fill -->
                                            <ProgressBar Progress="{Binding WeightedProgress}"
                                                         ProgressColor="{StaticResource Primary}"
                                                         HeightRequest="12"
                                                         VerticalOptions="Center"
                                                         ScaleY="1.0"/>
                                        </Grid>
                                    </VerticalStackLayout>

                                    <!-- Load Bar (Capacity) -->
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="Load" 
                                               FontFamily="InterMedium"
                                               FontSize="11" 
                                               TextColor="{StaticResource Gray400}"/>
                                        <Grid HeightRequest="12">
                                            <!-- Background Track -->
                                            <Border HeightRequest="12"
                                                    StrokeShape="RoundRectangle 6"
                                                    BackgroundColor="{StaticResource Gray100}"
                                                    StrokeThickness="0"/>
                                            
                                            <!-- Load Fill -->
                                            <ProgressBar Progress="{Binding LoadProgress}"
                                                         ProgressColor="{Binding LoadColor}"
                                                         HeightRequest="12"
                                                         VerticalOptions="Center"
                                                         ScaleY="1.0"/>
                                        </Grid>
                                    </VerticalStackLayout>

                                    <!-- Intensity Label Row -->
                                    <Grid ColumnDefinitions="Auto, *">
                                        <Label Text="Intensity" 
                                               FontFamily="InterMedium"
                                               FontSize="11" 
                                               TextColor="{StaticResource Gray400}"
                                               VerticalOptions="Center"/>
                                        
                                        <Border Grid.Column="1" 
                                                StrokeShape="RoundRectangle 4"
                                                BackgroundColor="#ecf2ff"
                                                StrokeThickness="0"
                                                Padding="8,2"
                                                HorizontalOptions="End">
                                            <Label Text="{Binding Intensity}" 
                                                   FontFamily="InterBold"
                                                   FontSize="11" 
                                                   TextColor="{StaticResource Primary}"/>
                                        </Border>
                                    </Grid>
                                </VerticalStackLayout>

                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </StackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
