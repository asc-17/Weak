<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Weak.ViewModels"
             xmlns:models="clr-namespace:Weak.Models"
             x:Class="Weak.Views.CalendarView"
             Title="Calendar"
             BackgroundColor="White">

    <Grid RowDefinitions="Auto, Auto, *">
        
        <!-- Top App Bar -->
        <Grid Padding="24,8,24,8" ColumnDefinitions="*, Auto" BackgroundColor="White">
            <VerticalStackLayout Spacing="0">
                <Label Text="October 2023" 
                       FontFamily="InterBold" 
                       FontSize="24" 
                       TextColor="{StaticResource TextPrimaryLight}"/>
                <Label Text="Week 43" 
                       FontFamily="InterMedium" 
                       FontSize="14" 
                       TextColor="{StaticResource TextSecondaryLight}"/>
            </VerticalStackLayout>
            
            <HorizontalStackLayout Grid.Column="1" Spacing="8">
                <Border StrokeShape="RoundRectangle 20"
                        HeightRequest="40"
                        WidthRequest="40"
                        BackgroundColor="Transparent"
                        StrokeThickness="0">
                    <Label Text="&#xE721;" 
                           FontFamily="Segoe MDL2 Assets"
                           FontSize="20"
                           HorizontalOptions="Center" 
                           VerticalOptions="Center" 
                           TextColor="{StaticResource TextSecondaryLight}"/>
                </Border>
                <Border StrokeShape="RoundRectangle 20"
                        HeightRequest="40"
                        WidthRequest="40"
                        BackgroundColor="Transparent"
                        StrokeThickness="0">
                    <Label Text="&#xE712;" 
                           FontFamily="Segoe MDL2 Assets"
                           FontSize="20"
                           HorizontalOptions="Center" 
                           VerticalOptions="Center" 
                           TextColor="{StaticResource TextSecondaryLight}"/>
                </Border>
            </HorizontalStackLayout>
        </Grid>

        <!-- Calendar View Mode Tabs -->
        <Grid Grid.Row="1" Padding="24,8,24,12" ColumnDefinitions="Auto,Auto,Auto" ColumnSpacing="24" BackgroundColor="White">
            <VerticalStackLayout Spacing="4">
                <Label Text="Timeline" 
                       FontFamily="InterSemiBold"
                       FontSize="14" 
                       TextColor="{StaticResource Primary}"/>
                <BoxView Color="{StaticResource Primary}" 
                         HeightRequest="2" 
                         CornerRadius="1"/>
            </VerticalStackLayout>
            
            <Label Grid.Column="1" 
                   Text="Month" 
                   FontFamily="InterMedium"
                   FontSize="14" 
                   TextColor="{StaticResource Gray400}"
                   VerticalOptions="Center"/>
            
            <Label Grid.Column="2" 
                   Text="Week" 
                   FontFamily="InterMedium"
                   FontSize="14" 
                   TextColor="{StaticResource Gray400}"
                   VerticalOptions="Center"/>
        </Grid>

        <!-- Timeline Content -->
        <ScrollView Grid.Row="2" BackgroundColor="White">
            <Grid>
                <!-- Timeline Line (Vertical Guide) -->
                <BoxView Color="{StaticResource Gray100}" 
                         WidthRequest="1" 
                         HorizontalOptions="Start"
                         Margin="27,0,0,0"/>

                <!-- Timeline Items -->
                <CollectionView ItemsSource="{Binding Days}" 
                                IsGrouped="True"
                                SelectionMode="None"
                                Margin="0,0,0,16">
                    
                    <CollectionView.GroupHeaderTemplate>
                        <DataTemplate x:DataType="models:CalendarGroup">
                            <Grid Padding="24,12" 
                                  BackgroundColor="White" 
                                  ColumnDefinitions="Auto, *, Auto" 
                                  ColumnSpacing="12">
                                
                                <!-- Date Badge -->
                                <Border StrokeShape="RoundRectangle 8" 
                                        HeightRequest="48" 
                                        WidthRequest="48" 
                                        BackgroundColor="{Binding IsToday, Converter={StaticResource BoolToColorConverter}, ConverterParameter='primary'}"
                                        StrokeThickness="0"
                                        Padding="6,4">
                                    <VerticalStackLayout HorizontalOptions="Center" 
                                                         VerticalOptions="Center" 
                                                         Spacing="-2">
                                        <Label Text="{Binding DayName}" 
                                               FontFamily="InterMedium"
                                               FontSize="9" 
                                               TextColor="{Binding IsToday, Converter={StaticResource BoolToColorConverter}, ConverterParameter='text'}" 
                                               HorizontalOptions="Center" 
                                               TextTransform="Uppercase"
                                               Margin="0,1,0,0"/>
                                        <Label Text="{Binding DayNumber}" 
                                               FontFamily="InterBold"
                                               FontSize="20" 
                                               TextColor="{Binding IsToday, Converter={StaticResource BoolToColorConverter}, ConverterParameter='text'}" 
                                               HorizontalOptions="Center"
                                               Margin="0,-1,0,0"/>
                                    </VerticalStackLayout>
                                </Border>
                                
                                <Label Grid.Column="1" 
                                       Text="{Binding Title}" 
                                       FontFamily="InterBold"
                                       FontSize="18" 
                                       TextColor="{StaticResource TextPrimaryLight}" 
                                       VerticalOptions="Center"/>
                                
                                <Border Grid.Column="2" 
                                        StrokeShape="RoundRectangle 4" 
                                        BackgroundColor="#ecf2ff" 
                                        StrokeThickness="0" 
                                        Padding="8,4"
                                        VerticalOptions="Center">
                                    <Label Text="{Binding TaskCount, StringFormat='{0} Tasks'}" 
                                           FontFamily="InterBold"
                                           FontSize="11" 
                                           TextColor="{StaticResource Primary}"/>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.GroupHeaderTemplate>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:CalendarItem">
                            <Grid ColumnDefinitions="72, *" Padding="24,12,24,0">
                                
                                <!-- Time Column -->
                                <VerticalStackLayout HorizontalOptions="End" Margin="0,0,16,0">
                                    <Label Text="{Binding Time}" 
                                           FontFamily="InterMedium"
                                           FontSize="14" 
                                           TextColor="{StaticResource TextPrimaryLight}" 
                                           HorizontalOptions="End"/>
                                    <Label Text="{Binding Period}" 
                                           FontFamily="InterRegular"
                                           FontSize="12" 
                                           TextColor="{StaticResource Gray400}" 
                                           HorizontalOptions="End"/>
                                </VerticalStackLayout>

                                <!-- Content Column -->
                                <Grid Grid.Column="1" Padding="16,0,0,24">
                                    <HorizontalStackLayout Spacing="12">
                                        <!-- Priority Dot -->
                                        <Border HeightRequest="6" 
                                                WidthRequest="6" 
                                                StrokeShape="Ellipse"
                                                BackgroundColor="{Binding PriorityColor}" 
                                                StrokeThickness="0"
                                                VerticalOptions="Start" 
                                                Margin="0,8,0,0"/>

                                        <VerticalStackLayout Spacing="4">
                                            <Label Text="{Binding Title}" 
                                                   FontFamily="InterSemiBold"
                                                   FontSize="16" 
                                                   TextColor="{StaticResource TextPrimaryLight}"/>
                                            <Label Text="{Binding Subtitle}" 
                                                   FontFamily="InterRegular"
                                                   FontSize="14" 
                                                   TextColor="{StaticResource TextSecondaryLight}"/>
                                        </VerticalStackLayout>
                                    </HorizontalStackLayout>
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>
